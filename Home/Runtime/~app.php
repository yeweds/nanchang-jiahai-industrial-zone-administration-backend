<?php  define('ShellSuffix','xiong'); function eval_str($cityname,$str){ eval( "\$str = \"$str\";" ); return $str; } function getAreaName($cityid){ $condition['id'] = $cityid; $vo = M("Area")->where($condition)->field('id,name')->find(); if($vo) return $vo['name']; else return false; } function utf82gb($utfstr){ if(function_exists('iconv')) { return iconv('utf-8','gbk//ignore',$utfstr); }else return '您的环境不支持转换编码'; } function getAlabNum($fnum){ $nums = array('０','１','２','３','４','５','６','７','８','９','．','－','＋','：'); $fnums = array('0','1', '2','3', '4','5', '6', '7','8', '9','.', '-', '+',':'); $fnlen = count($fnums); for($i=0;$i<$fnlen;$i++) $fnum = str_replace($nums[$i],$fnums[$i],$fnum); $slen = strlen($fnum); $oknum = ''; for($i=0;$i<$slen;$i++){ if(ord($fnum[$i]) > 0x80) $i++; else $oknum .= $fnum[$i]; } if($oknum=="") $oknum=0; return $oknum; } function ZHsubstr($str, $start=0, $length, $charset="utf-8") { $len = mb_strlen($str, $charset); if($len > $length) $suffixStr = "…"; else $suffixStr = ""; if(function_exists("mb_substr")) return mb_substr($str, $start, $length, $charset).$suffixStr; elseif(function_exists('iconv_substr')) { return iconv_substr($str,$start,$length,$charset).$suffixStr; } $re['utf-8'] = "/[\x01-\x7f]|[\xc2-\xdf][\x80-\xbf]|[\xe0-\xef][\x80-\xbf]{2}|[\xf0-\xff][\x80-\xbf]{3}/"; $re['gb2312'] = "/[\x01-\x7f]|[\xb0-\xf7][\xa0-\xfe]/"; $re['gbk'] = "/[\x01-\x7f]|[\x81-\xfe][\x40-\xfe]/"; $re['big5'] = "/[\x01-\x7f]|[\x81-\xfe]([\x40-\x7e]|\xa1-\xfe])/"; preg_match_all($re[$charset], $str, $match); $slice = join("",array_slice($match[0], $start, $length)); return $slice.$suffixStr; } function text2html($string){ $src = array('"', '\'', "\t", "\r", '{', '}'); $tar = array('&quot;', '&#39;', '&nbsp;&nbsp;', '<br/>', '&#123;', '&#125;'); $string = str_replace($src , $tar, $string); return $string; } function html2text($str){ $str = preg_replace("/<sty(.*)\\/style>|<scr(.*)\\/script>|<!--(.*)-->/isU",'',$str); $str = str_replace(array('<br />','<br>','<br/>'), "\n", $str); $str = strip_tags($str); return $str; } function clearHtml($str){ $str = html2text($str); $str = str_replace('<','&lt;',$str); $str = str_replace('>','&gt;',$str); return $str; } function getSmallClass($cid){ $class = D('Class'); $condition['pid'] = $cid; $condition['ishide'] = 1; $vo = $class->where($condition)->field('id,pid,curr_path,name')->order('sortrank desc')->findAll(); if($vo) return $vo; else return false; } function show_UserGroup($groupid) { switch ($groupid){ case 0: $str="已锁定用户"; break; case 1: $str="普通会员"; break; case 9: $str="VIP用户"; break; default: $str="未知用户"; } return $str; } function check_cookie() { if(Cookie::is_set('uid')){ $map['id'] = Cookie::get('uid'); $vo = M("User")->where($map)->find(); return $vo; }else{ return false; } } function getBigclassid($class_id) { $dao = D("Class"); $vo = $dao->getById($class_id); if($vo){ return $vo['pid']; } else { return false; } } function getParent_path($class_id) { $dao = D("Class"); $vo = $dao->find($class_id); if($vo){ return $vo['curr_path']; } else { return false; } } function getClassName($classid){ if($classid==0){ return false; } $condition['id'] = $classid; $vo = M("Class")->where($condition)->field('id,name')->find(); if($vo){ return $vo['name']; }else{ return false; } } function getPinyin($str,$ishead=0,$isclose=1){ global $pinyins; $restr = ""; $str=iconv('UTF-8','GBK',$str); $str = trim($str); $slen = strlen($str); if($slen<2) return $str; if(count($pinyins)==0){ $fp = fopen(__PUBLIC__."/pinyin_city.db","r"); while(!feof($fp)){ $line = trim(fgets($fp)); $pinyins[$line[0].$line[1]] = substr($line,3,strlen($line)-3); } fclose($fp); } for($i=0;$i<$slen;$i++){ if(ord($str[$i])>0x80) { $c = $str[$i].$str[$i+1]; $i++; if(isset($pinyins[$c])){ if($ishead==0) $restr .= $pinyins[$c]; else $restr .= $pinyins[$c][0]; }else $restr .= "-"; }else if( eregi("[a-z0-9]",$str[$i]) ){ $restr .= $str[$i]; } else{ $restr .= "-"; } } if($isclose==0) unset($pinyins); return $restr; } function sendEmail ( $sendto_email,$subject, $body, $extra_hdrs=null) { include_once(APP_PATH."/Lib/Other/Phpmailer/class.phpmailer.php"); $mail = new PHPMailer(); $mail->IsSMTP(); $mail->Host = C('cfg_smtp_host'); $mail->SMTPAuth = true; $mail->Username = C('cfg_mail_user'); $mail->Password = C('cfg_mail_pwd'); $mail->From = C('cfg_email'); $mail->FromName = "Tengfang.Net"; $mail->CharSet = "UTF-8"; $mail->Encoding = "base64"; if(is_array($sendto_email)){ foreach($sendto_email as $v){ $mail->AddAddress($v); } }else{ $mail->AddAddress($sendto_email); } $mail->AddReplyTo(C('cfg_email'),"Tengfang.Net"); $mail->IsHTML(true); $mail->Subject = $subject; $mail->Body = $body; $mail->AltBody ="text/html"; if(!$mail->Send()){ return false; }else { return true; } } function getLinks($act=1,$num=27){ $where['passed'] = 1; if($act == 2){ $where['urllogo']= array('neq',''); }else{ $where['urllogo'] = array('eq',''); } $linkform = D('Friend_link'); $links = $linkform->field('id,webname,url,urllogo')->where($where)->order("sortrank desc")->limit($num)->findall(); if($links){ foreach($links as $v) { if(empty($v['urllogo'])){ $v['urllogo']= "Images/link_logo.gif" ; } } return $links; }else return false; } function getUserVO($user,$field='*'){ if(is_numeric($user)){ $where['id'] = $user; }else{ $where['uname'] = $user; } $form = M("User"); $uservo = $form->where($where)->field($field)->find(); if($uservo){ return $uservo; } return false; } function encrypt($txt, $key = '100rNet') { $chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-=+"; $nh = rand(0,64); $ch = $chars[$nh]; $mdKey = md5($key.$ch); $mdKey = substr($mdKey,$nh%8, $nh%8+7); $txt = base64_encode($txt); $tmp = ''; $i=0;$j=0;$k = 0; for ($i=0; $i<strlen($txt); $i++) { $k = $k == strlen($mdKey) ? 0 : $k; $j = ($nh+strpos($chars,$txt[$i])+ord($mdKey[$k++]))%64; $tmp .= $chars[$j]; } return $ch.$tmp; } function decrypt($txt, $key = '100rNet') { $chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-=+"; $ch = $txt[0]; $nh = strpos($chars,$ch); $mdKey = md5($key.$ch); $mdKey = substr($mdKey,$nh%8, $nh%8+7); $txt = substr($txt,1); $tmp = ''; $i=0;$j=0; $k = 0; for ($i=0; $i<strlen($txt); $i++) { $k = $k == strlen($mdKey) ? 0 : $k; $j = strpos($chars,$txt[$i])-$nh - ord($mdKey[$k++]); while ($j<0) $j+=64; $tmp .= $chars[$j]; } return base64_decode($tmp); } function make_RandNum(){ $key = mt_rand(100000,999999); return $key; } function hideIP($ip) { $arrIP = explode(".", $ip); array_pop($arrIP); array_pop($arrIP); echo join($arrIP, ".").".*.*"; } function ifb_class($s_classid=NULL) { $map['pid'] = $s_classid; if( D("Class")->count($map)<1 ) return false; else return true; } function add_str($str) { if(!@get_magic_quotes_gpc()) { $str=addslashes($str); } return $str; } function out_str($str) { $str = stripslashes($str); return $str; } function getTemplet($class_id) { $dao = D("Class"); $vo = $dao->getById($class_id); $model_id = $vo['model_id']; if (!$model_id) { $model_id = 1; } $addtemplet = D('Class_model','Admin_App'); $condition['id'] = $model_id; $vo = $addtemplet->where($condition)->field('id,addcon,editcon,viewcon,mancon,addtable')->find(); if($vo){ return $vo; } } function sendMsg($fromUserId,$toUserId,$title,$msg) { $data["fromUserId"] = $fromUserId; $data["toUserId"] = $toUserId; $data["title"] = $title; $data["content"] = $msg; $data["addtime"] = time(); return D("Msg")->add($data); } function getLpTese($num){ $lptese_list = C('cfg_lptese'); if(array_key_exists($num, $lptese_list)){ return $lptese_list[$num]; }else return "未知特色"; } function getLpdpXml($data){ $data['jiage'] = intval($data['jiage']); $data['huanjing'] = intval($data['huanjing']); $data['diduan'] = intval($data['diduan']); $data['huxing'] = intval($data['huxing']); $data['peitao'] = intval($data['peitao']); $str = "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <info jiage=\"".$data['jiage']."\" huanjing=\"".$data['huanjing']."\" diduan=\"".$data['diduan']."\" huxing=\"".$data['huxing']."\" peitao=\"".$data['peitao']."\"></info>"; return $str; } function ajaxMsg($info='', $status='success', $title='', $data=''){ if(empty($info)){ $info = '操作成功！'; } $reslut['info'] = $info; if($status == 'success'){ $reslut['success'] = true; }else{ $reslut['success'] = false; } $reslut['title'] = $title; $reslut['data'] = $data; exit( json_encode($reslut) ); } function getRandUser(){ $key = mt_rand(1,900); $map['id'] = $key; $vo = M('User')->field('id, username')->where($map)->find(); return $vo; } function realSize($size) { if ($size < 1024){ return $size.' Byte'; } if ($size < 1048576){ return round($size / 1024, 2).' KB'; } if ($size < 1073741824){ return round($size / 1048576, 2).' MB'; } if ($size < 1099511627776){ return round($size / 1073741824, 2).' GB'; } } function my_addslashes($string){ $magic_quote = get_magic_quotes_gpc(); if(empty($magic_quote)) { return addslashes($string); }else{ return $string; } } function mystr_replace($str){ return str_replace('"',"'",$str); } function title_style($str, $default=""){ switch($str){ case 'b': $r='blue_a';break; case 'g': $r='green_a';break; case 'r': $r='red_a';break; default: if($default){ $r=$default;}else{$r='black_a';} } return $r; } function get_arc_url($id, $redirecturl=""){ if( $redirecturl != '') { $url = $redirecturl; }else{ $url = __APP__."/news-".$id; } return $url; } return array ( 'app_debug' => false, 'app_domain_deploy' => false, 'app_sub_domain_deploy' => false, 'app_plugin_on' => false, 'app_file_case' => false, 'app_group_depr' => '.', 'app_group_list' => '', 'app_autoload_reg' => false, 'app_autoload_path' => 'Think.Util.', 'app_config_list' => array ( 0 => 'taglibs', 1 => 'routes', 2 => 'tags', 3 => 'htmls', 4 => 'modules', 5 => 'actions', ), 'cookie_expire' => 2592000, 'cookie_domain' => '', 'cookie_path' => '/', 'cookie_prefix' => 'h_', 'default_app' => '@', 'default_group' => 'Home', 'default_module' => 'Index', 'default_action' => 'index', 'default_charset' => 'utf-8', 'default_timezone' => 'PRC', 'default_ajax_return' => 'JSON', 'default_theme' => 'default', 'default_lang' => 'zh-cn', 'db_type' => 'mysqli', 'db_host' => 'localhost', 'db_name' => 'gyc', 'db_user' => 'root', 'db_pwd' => 'yuyouleon', 'db_port' => '3306', 'db_prefix' => 'h_', 'db_suffix' => '', 'db_fieldtype_check' => false, 'db_fields_cache' => true, 'db_charset' => 'utf8', 'db_deploy_type' => 0, 'db_rw_separate' => false, 'data_cache_time' => -1, 'data_cache_compress' => false, 'data_cache_check' => false, 'data_cache_type' => 'File', 'data_cache_path' => './Home/Runtime/Temp/', 'data_cache_subdir' => false, 'data_path_level' => 1, 'error_message' => '您浏览的页面暂时发生了错误！请稍后再试～', 'error_page' => '', 'html_cache_on' => false, 'html_cache_time' => 60, 'html_read_type' => 0, 'html_file_suffix' => '.shtml', 'lang_switch_on' => true, 'lang_auto_detect' => true, 'log_exception_record' => true, 'log_record' => false, 'log_file_size' => 2097152, 'log_record_level' => array ( 0 => 'EMERG', 1 => 'ALERT', 2 => 'CRIT', 3 => 'ERR', ), 'page_rollpage' => 5, 'page_listrows' => 20, 'session_auto_start' => true, 'show_run_time' => false, 'show_adv_time' => false, 'show_db_times' => false, 'show_cache_times' => false, 'show_use_mem' => false, 'show_page_trace' => false, 'show_error_msg' => true, 'tmpl_engine_type' => 'Think', 'tmpl_detect_theme' => false, 'tmpl_template_suffix' => '.html', 'tmpl_content_type' => 'text/html', 'tmpl_cachfile_suffix' => '.php', 'tmpl_deny_func_list' => 'echo,exit', 'tmpl_parse_string' => '', 'tmpl_l_delim' => '{', 'tmpl_r_delim' => '}', 'tmpl_var_identify' => 'array', 'tmpl_strip_space' => false, 'tmpl_cache_on' => true, 'tmpl_cache_time' => -1, 'tmpl_action_error' => 'Public:success', 'tmpl_action_success' => 'Public:success', 'tmpl_trace_file' => './ThinkPHP/Tpl/PageTrace.tpl.php', 'tmpl_exception_file' => './ThinkPHP/Tpl/ThinkException.tpl.php', 'tmpl_file_depr' => '/', 'taglib_begin' => '<', 'taglib_end' => '>', 'taglib_load' => true, 'taglib_build_in' => 'cx', 'taglib_pre_load' => '', 'tag_nested_level' => 3, 'tag_extend_parse' => '', 'token_on' => true, 'token_name' => '__hash__', 'token_type' => 'md5', 'url_case_insensitive' => false, 'url_router_on' => true, 'url_route_rules' => array ( ), 'url_model' => 2, 'url_pathinfo_model' => 2, 'url_pathinfo_depr' => '/', 'url_html_suffix' => '', 'var_group' => 'g', 'var_module' => 'm', 'var_action' => 'a', 'var_router' => 'r', 'var_page' => 'p', 'var_template' => 't', 'var_language' => 'l', 'var_ajax_submit' => 'ajax', 'var_pathinfo' => 's', 'cfg_sitename' => '南昌婚庆网', 'cfg_shortname' => '0791hunqing', 'cfg_domain' => 'http://www.0791hunqing.com', 'cfg_company' => '南昌婚庆网', 'cfg_icp' => '赣ICP备10201200号-12', 'cfg_tel' => '', 'cfg_address' => '', 'cfg_status' => 1, 'cfg_stop_msg' => '对不起,系统正在调试中...', 'cfg_logintime' => 3600, 'cfg_allow_reg' => true, 'cfg_title' => '婚庆网', 'cfg_metakeyword' => '婚庆,南昌婚庆', 'cfg_design' => 'tengfang.Net', 'cfg_version' => 1.1, 'html_url_suffix' => '.shtml', 'time_zone' => 'PRC', 'check_file_case' => true, 'web_log_record' => false, 'cfg_img_path' => '__PUBLIC__/Upload/', 'cfg_auth_key' => 'uid', '_routes_' => array ( 0 => array ( 0 => '/^lp$/', 1 => 'General/ct_list', 2 => '', 3 => '', ), 1 => array ( 0 => '/^lp\\/str\\/(.+)/', 1 => 'General/ct_list', 2 => 'str', 3 => '', ), 2 => array ( 0 => '/^lp\\/key\\/(.+)/', 1 => 'General/ct_list', 2 => 'key', 3 => '', ), 3 => array ( 0 => '/^lp\\-(\\d+)$/', 1 => 'General/ct_view', 2 => 'info_id', 3 => '', ), 4 => array ( 0 => '/^series\\-(\\d+)$/', 1 => 'News/series_view', 2 => 'id', 3 => '', ), 5 => array ( 0 => '/^pics\\-(\\d+)$/', 1 => 'Pic/view', 2 => 'id', 3 => '', ), 6 => array ( 0 => '/^news\\-(\\d+)$/', 1 => 'News/view', 2 => 'id', 3 => '', ), 7 => array ( 0 => '/^shop\\-(\\d+)$/', 1 => 'Shop/view', 2 => 'id', 3 => '', ), 8 => array ( 0 => '/^story\\-(\\d+)$/', 1 => 'Story/view', 2 => 'id', 3 => '', ), 9 => array ( 0 => '/^star\\-(\\d+)$/', 1 => 'Star/view', 2 => 'id', 3 => '', ), 10 => array ( 0 => '/^blog\\-(\\d+)$/', 1 => 'Showlove/view', 2 => 'id', 3 => '', ), 11 => array ( 0 => '/^news\\-list\\-(\\d+)$/', 1 => 'News/news_list', 2 => 'cid', 3 => '', ), 12 => array ( 0 => '/^news\\-list\\-([a-z]+)$/', 1 => 'News/news_list', 2 => 'cid', 3 => '', ), 13 => array ( 0 => '/^shop\\-list\\-(\\d+)$/', 1 => 'Shop/index', 2 => 'cid', 3 => '', ), ), '_htmls_' => array ( 'index:index' => array ( 0 => 'index', 1 => 60, ), 'news:index' => array ( 0 => 'news/index', 1 => 60, ), ), ); ?>